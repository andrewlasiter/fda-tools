{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://fda-tools.claude.ai/schemas/data_manifest.schema.json",
  "title": "FDA Project Data Manifest",
  "description": "Schema for FDA project data manifest file (data_manifest.json). This file tracks cached API queries, fingerprints for change detection, product codes, and metadata for 510(k) and PMA projects.",
  "type": "object",
  "required": ["schema_version"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema version for migration support. Format: MAJOR.MINOR.PATCH (semantic versioning)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0", "1.1.0", "2.0.0"]
    },
    "project": {
      "type": "string",
      "description": "Human-readable project name. Typically matches the directory name.",
      "minLength": 1,
      "maxLength": 255,
      "examples": ["my_510k_project", "dqy_2024_analysis"]
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when the manifest was first created. Must be in UTC timezone.",
      "examples": ["2024-01-15T08:30:00+00:00", "2024-01-15T08:30:00Z"]
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the last manifest update. Auto-updated on every save. Must be in UTC timezone.",
      "examples": ["2024-01-15T08:30:00+00:00", "2024-01-15T08:30:00Z"]
    },
    "product_codes": {
      "type": "array",
      "description": "List of FDA product codes associated with this project. Auto-populated from queries.",
      "items": {
        "type": "string",
        "pattern": "^[A-Z]{3}$",
        "description": "Three-letter FDA product code (uppercase)"
      },
      "uniqueItems": true,
      "examples": [["DQY", "OVE", "GEI"]]
    },
    "queries": {
      "type": "object",
      "description": "Cached FDA API query results indexed by canonical query keys. Format: 'query_type:param1:param2'",
      "patternProperties": {
        "^[a-z0-9_-]+:.*$": {
          "$ref": "#/$defs/query_entry"
        }
      },
      "additionalProperties": false
    },
    "fingerprints": {
      "type": "object",
      "description": "Change detection fingerprints for product codes. Used by change_detector.py to identify new clearances, recalls, and data changes.",
      "patternProperties": {
        "^[A-Z]{3}$": {
          "$ref": "#/$defs/fingerprint_entry"
        }
      },
      "additionalProperties": false
    },
    "total_pmas": {
      "type": "integer",
      "description": "Total number of PMA entries tracked (PMA projects only). Auto-calculated from pma_entries.",
      "minimum": 0
    },
    "total_sseds_downloaded": {
      "type": "integer",
      "description": "Count of PMA SSED PDFs downloaded (PMA projects only). Auto-calculated.",
      "minimum": 0
    },
    "total_sections_extracted": {
      "type": "integer",
      "description": "Count of PMAs with extracted sections (PMA projects only). Auto-calculated.",
      "minimum": 0
    },
    "pma_entries": {
      "type": "object",
      "description": "PMA-specific cache entries indexed by PMA number (PMA projects only). Format: 'P######'",
      "patternProperties": {
        "^P\\d{6}[A-Z]?$": {
          "$ref": "#/$defs/pma_entry"
        }
      },
      "additionalProperties": false
    },
    "search_cache": {
      "type": "object",
      "description": "Cached PMA search results (PMA projects only). Indexed by search key (e.g., 'product_code:NMH:year:2024')",
      "patternProperties": {
        "^[a-z_]+:.*$": {
          "$ref": "#/$defs/search_cache_entry"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "query_entry": {
      "type": "object",
      "description": "Single cached FDA API query result with TTL and metadata",
      "required": ["fetched_at", "ttl_hours", "source"],
      "properties": {
        "fetched_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when this query was fetched from the API. UTC timezone required."
        },
        "ttl_hours": {
          "type": "integer",
          "description": "Time-to-live in hours. After this period, the cache entry is considered stale.",
          "minimum": 0,
          "maximum": 8760,
          "examples": [24, 168]
        },
        "source": {
          "type": "string",
          "description": "Data source identifier",
          "enum": ["openFDA", "FDA API", "manual"],
          "examples": ["openFDA"]
        },
        "total_matches": {
          "type": "integer",
          "description": "Total number of results from the API (from meta.results.total)",
          "minimum": 0
        },
        "summary": {
          "type": "object",
          "description": "Extracted summary fields from the API response. Structure varies by query type."
        },
        "api_cache_key": {
          "type": "string",
          "description": "Internal API client cache key for correlation with system-level cache files"
        }
      },
      "additionalProperties": false
    },
    "fingerprint_entry": {
      "type": "object",
      "description": "Change detection fingerprint for a product code. Tracks known clearances, recalls, and event counts.",
      "required": ["product_code", "last_updated"],
      "properties": {
        "product_code": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "Three-letter FDA product code (uppercase)"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when this fingerprint was last updated. UTC timezone."
        },
        "known_k_numbers": {
          "type": "array",
          "description": "List of known 510(k) numbers for this product code. Used to detect new clearances.",
          "items": {
            "type": "string",
            "pattern": "^K\\d{6}$",
            "description": "510(k) K-number in format K######"
          },
          "uniqueItems": true
        },
        "total_clearances": {
          "type": "integer",
          "description": "Total count of 510(k) clearances at last fingerprint update",
          "minimum": 0
        },
        "latest_clearance_date": {
          "type": "string",
          "description": "Decision date of the most recent clearance (YYYY-MM-DD or ISO 8601)",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}",
          "examples": ["2024-01-15", "2024-01-15T00:00:00Z"]
        },
        "total_recalls": {
          "type": "integer",
          "description": "Total count of recalls at last fingerprint update",
          "minimum": 0
        },
        "latest_recall_date": {
          "type": "string",
          "description": "Date of the most recent recall event (YYYY-MM-DD or ISO 8601)",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}",
          "examples": ["2024-01-15", "2024-01-15T00:00:00Z"]
        },
        "total_adverse_events": {
          "type": "integer",
          "description": "Total count of MAUDE adverse events at last fingerprint update",
          "minimum": 0
        },
        "deaths": {
          "type": "integer",
          "description": "Count of adverse events classified as deaths",
          "minimum": 0
        },
        "injuries": {
          "type": "integer",
          "description": "Count of adverse events classified as injuries",
          "minimum": 0
        },
        "malfunctions": {
          "type": "integer",
          "description": "Count of adverse events classified as malfunctions",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "pma_entry": {
      "type": "object",
      "description": "PMA-specific cache entry with approval data, SSED status, and extraction status",
      "required": ["pma_number", "first_cached_at"],
      "properties": {
        "pma_number": {
          "type": "string",
          "pattern": "^P\\d{6}[A-Z]?$",
          "description": "PMA number in format P###### or P######X"
        },
        "first_cached_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when this PMA was first cached. UTC timezone."
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the last update to this entry. UTC timezone."
        },
        "pma_approval_fetched_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when PMA approval data was fetched. UTC timezone."
        },
        "pma_supplements_fetched_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when PMA supplement data was fetched. UTC timezone."
        },
        "device_name": {
          "type": "string",
          "description": "Device trade name or generic name from PMA approval data"
        },
        "applicant": {
          "type": "string",
          "description": "Company or individual that submitted the PMA"
        },
        "product_code": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "Three-letter FDA product code"
        },
        "decision_date": {
          "type": "string",
          "description": "PMA approval decision date (YYYY-MM-DD or ISO 8601)",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}"
        },
        "advisory_committee": {
          "type": "string",
          "description": "Two-letter advisory committee code (e.g., 'CV', 'OR', 'RA')"
        },
        "supplement_count": {
          "type": "integer",
          "description": "Number of supplements associated with this PMA",
          "minimum": 0
        },
        "ssed_downloaded": {
          "type": "boolean",
          "description": "True if the SSED PDF has been downloaded for this PMA"
        },
        "ssed_filepath": {
          "type": "string",
          "description": "Absolute or relative path to the downloaded SSED PDF file"
        },
        "ssed_file_size_kb": {
          "type": "integer",
          "description": "Size of the SSED PDF file in kilobytes",
          "minimum": 0
        },
        "ssed_url": {
          "type": "string",
          "format": "uri",
          "description": "URL from which the SSED PDF was downloaded"
        },
        "ssed_downloaded_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when the SSED PDF was downloaded. UTC timezone."
        },
        "sections_extracted": {
          "type": "boolean",
          "description": "True if sections have been extracted from the SSED PDF"
        },
        "section_count": {
          "type": "integer",
          "description": "Number of sections extracted from the SSED PDF",
          "minimum": 0,
          "maximum": 15
        },
        "total_word_count": {
          "type": "integer",
          "description": "Total word count across all extracted sections",
          "minimum": 0
        },
        "sections_extracted_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when sections were extracted. UTC timezone."
        }
      },
      "additionalProperties": false
    },
    "search_cache_entry": {
      "type": "object",
      "description": "Cached PMA search result with TTL tracking",
      "required": ["results", "fetched_at", "result_count"],
      "properties": {
        "results": {
          "type": "array",
          "description": "Array of PMA result objects from the search query",
          "items": {
            "type": "object"
          }
        },
        "fetched_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when this search was executed. UTC timezone."
        },
        "result_count": {
          "type": "integer",
          "description": "Number of results returned by the search",
          "minimum": 0
        }
      },
      "additionalProperties": false
    }
  }
}
