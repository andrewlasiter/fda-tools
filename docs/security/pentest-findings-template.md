# MDRP Penetration Test Findings Report
## FDA-261  [SEC-010] OWASP Top 10 — Scope, Methodology, Findings Template

---

## Engagement Details

| Field | Value |
|-------|-------|
| Scope | MDRP Cloud (SaaS), MDRP Desktop API bridge, Nginx ingress |
| Standard | OWASP Testing Guide v4.2, OWASP Top 10:2021 |
| Frequency | Quarterly (minimum) |
| Remediation SLA | Critical: 24h \| High: 7d \| Medium: 30d \| Low: 90d |
| Last completed | *(to be filled by RA lead)* |
| Tester | *(third-party firm name)* |

---

## OWASP Top 10:2021 Coverage Checklist

| # | Category | MDRP Test Areas | Status |
|---|----------|-----------------|--------|
| A01 | Broken Access Control | RBAC, Supabase RLS, API auth headers, IDOR on /projects/[id] | [ ] |
| A02 | Cryptographic Failures | TLS version, HSTS, encryption at rest (AES-256), token entropy | [ ] |
| A03 | Injection | SQL via FastAPI params, XSS in TipTap editor, eSTAR XML generation | [ ] |
| A04 | Insecure Design | HITL gate bypass, NPD state machine forced transitions | [ ] |
| A05 | Security Misconfiguration | Docker security context, Nginx default files, CORS headers | [ ] |
| A06 | Vulnerable Components | Python deps (safety scan), npm audit, Electron Chromium version | [ ] |
| A07 | Auth and Session | Session token entropy, CSRF, Supabase Auth magic-link expiry | [ ] |
| A08 | Software and Data Integrity | Electron auto-update signature verification, npm lockfile | [ ] |
| A09 | Logging & Monitoring Failures | 21 CFR Part 11 audit log completeness, SIEM integration | [ ] |
| A10 | SSRF | /api/research proxy, Supabase client URL parameter, webhook endpoints | [ ] |

---

## Finding Template

Each finding must be documented with the following fields:

```
### FIND-NNN: [Short Title]

**Severity:** Critical / High / Medium / Low / Informational
**OWASP Category:** A0N — [Name]
**CVSSv3 Score:** N.N (Vector: ...)
**CWE:** CWE-NNN

**Affected Component:**
[Service, endpoint, or file path]

**Description:**
[Plain-language description of the vulnerability]

**Proof of Concept:**
[Step-by-step reproduction, sanitised — no live exploit code in report]
```
[request/response snippet]
```

**Impact:**
[What an attacker could achieve: data exfiltration, privilege escalation, etc.]

**Recommendation:**
[Specific code or config change required]

**Regulatory Implication:**
[If applicable: 21 CFR Part 11, HIPAA, ISO 27001 control affected]
```

---

## Pre-Engagement Hardening Checklist

These controls are in place before the engagement and serve as the baseline:

### A01 — Broken Access Control
- [x] Supabase Row Level Security enabled on all tables (FDA-219)
- [x] RBAC: Admin / RA Lead / Engineer / Viewer roles (CC6.1)
- [x] HITL gates block stage advancement without APPROVED GateApprovalRecord
- [x] Nginx hides X-FDA-Bridge-Key from browser responses
- [x] Electron preload.js: ALLOWED_INVOKE channel allowlist

### A02 — Cryptographic Failures
- [x] TLS 1.2+ only (`ssl_protocols TLSv1.2 TLSv1.3`)
- [x] HSTS with 63072000s max-age + preload
- [x] Session tokens: `secrets.token_bytes(32)` (256-bit entropy)
- [x] NEXTAUTH_SECRET: 32-byte random hex (env var, never in code)
- [x] `constant_time_compare()` for token validation

### A03 — Injection
- [x] `sanitize_input()` at all API boundary fields
- [x] Parameterised SQL via SQLAlchemy ORM (no raw query strings)
- [x] eSTAR XML uses CDATA wrapping for user content
- [x] CSP header: `script-src 'self'` (blocks inline XSS in most vectors)

### A04 — Insecure Design
- [x] NPD state machine validates transitions via VALID_TRANSITION_SET
- [x] Gate enforcement: wrong gate_id raises GateBlockedError
- [x] Agent precondition check before stage advancement

### A05 — Security Misconfiguration
- [x] Docker: non-root `nextjs` user (uid 1001)
- [x] Electron: nodeIntegration: false, sandbox: true, contextIsolation: true
- [x] CORS: FastAPI CORSMiddleware with explicit allow_origins
- [x] Nginx: `X-Content-Type-Options nosniff`, `X-Frame-Options SAMEORIGIN`

### A06 — Vulnerable and Outdated Components
- [x] CI: `pip-audit` in Python test job
- [x] CI: `npm audit --audit-level=high` in frontend job
- [x] Dependabot configured for Python + npm ecosystems

### A07 — Identification and Authentication Failures
- [x] Supabase Auth: magic link expiry 1h
- [x] CSRF token: `generate_csrf_token()` on all state-changing forms
- [x] MFA required for Admin and RA Lead roles (CC6.7)

### A08 — Software and Data Integrity Failures
- [x] Electron: `autoUpdater` verifies update signatures via electron-updater
- [x] npm: `package-lock.json` committed; `npm ci` in CI (no `npm install`)
- [x] GitHub Actions: `actions/checkout@v4` pinned to SHA

### A09 — Security Logging and Monitoring Failures
- [x] 21 CFR Part 11 audit log: append-only PostgreSQL table
- [x] All NpdEvent / GateApprovalRecord records timestamped `datetime.now(timezone.utc)`
- [x] Electron: electron-log captures main process errors

### A10 — Server-Side Request Forgery (SSRF)
- [x] FastAPI: URL parameters for external services validated against allowlist
- [x] Supabase client URL: read from env var `SUPABASE_URL` only (no user input)
- [x] Nginx: upstream addresses hardcoded in config (no dynamic proxy)

---

## Post-Engagement Remediation Tracker

| Finding ID | Severity | Component | Status | Remediation PR | Verified By |
|------------|----------|-----------|--------|---------------|-------------|
| *(populated by pen tester)* | | | | | |

---

## Attestation

> The controls above are implemented and verified as of the date of the last
> SOC 2 control run. Independent third-party penetration testing is required
> quarterly. Findings must be remediated within the SLAs above and verified
> by re-testing before closure.
>
> RA Lead signature: _________________________ Date: ___________
